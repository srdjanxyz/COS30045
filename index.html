<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>COS30045 Data Visualisation
        Assignment 3C: Website and visualisation
    </title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/6.7.0/d3.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background-color: #f4f7f6;
            color: #333;
            padding: 20px;
        }

        h1 {
            margin-bottom: 2rem;
            color: #555;
            text-align: center;
        }

        .controls {
            margin-bottom: 2rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1rem;
        }

        label {
            font-weight: bold;
            color: #555;
        }

        select {
            padding: 8px 12px;
            font-size: 1rem;
            border: 2px solid #ddd;
            border-radius: 4px;
            background-color: white;
            color: #333;
            min-width: 300px;
        }

        select:focus {
            outline: none;
            border-color: #1f78b4;
        }

        #chart-container {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        svg {
            background-color: #fff;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            margin-bottom: 1rem;
        }

        .line {
            fill: none;
            stroke-width: 2.5;
            opacity: 0.8;
        }

        .line:hover {
            opacity: 1;
            stroke-width: 3;
        }

        .country-label {
            font-size: 0.9rem;
            font-weight: bold;
            fill: #333;
        }

        .axis {
            font-size: 0.8rem;
        }

        .axis-label {
            font-size: 1rem;
            font-weight: bold;
            fill: #555;
        }

        .tooltip {
            position: absolute;
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 8px 12px;
            border-radius: 4px;
            pointer-events: none;
            font-size: 0.9rem;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .chart-title {
            font-size: 1.2rem;
            font-weight: bold;
            fill: #333;
            text-anchor: middle;
        }

        .loading {
            font-size: 1.2rem;
            color: #666;
        }
    </style>
</head>

<body>
    <h1>COS30045 Data Visualisation<br>Assignment 3C: Website and visualisation</h1>

    <div class="controls">
        <label for="measure-select">Choose a measure:</label>
        <select id="measure-select">
            <option value="">Loading data...</option>
        </select>
    </div>

    <div id="chart-container">
        <div class="loading">Loading data...</div>
    </div>
    <div class="tooltip" id="tooltip"></div>

    <script>
        const width = 1000;
        const height = 600;
        const margin = { top: 80, right: 150, bottom: 80, left: 80 };

        const chartWidth = width - margin.left - margin.right;
        const chartHeight = height - margin.top - margin.bottom;

        function loadData() {
            try {
                const csvContent = `STRUCTURE,STRUCTURE_ID,STRUCTURE_NAME,ACTION,REF_AREA,Reference area,FREQ,Frequency of observation,MEASURE,Measure,AGE,Age,SEX,Sex,UNIT_MEASURE,Unit of measure,METHODOLOGY,Measurement method,TIME_PERIOD,Time period,OBS_VALUE,Observation value,OBS_STATUS,Observation status,UNIT_MULT,Unit multiplier,DECIMALS,Decimals
DATAFLOW,OECD.ELS.HD:DSD_HEALTH_LVNG@DF_HEALTH_LVNG(1.0),Risk factors for health,I,USA,United States,A,Annual,FTS,Fat supply,_T,Total,_T,Total,G_PS_D,Grammes per person per day,_Z,Not applicable,1961,,110.2,,A,Normal value,0,Units,,
DATAFLOW,OECD.ELS.HD:DSD_HEALTH_LVNG@DF_HEALTH_LVNG(1.0),Risk factors for health,I,USA,United States,A,Annual,FTS,Fat supply,_T,Total,_T,Total,G_PS_D,Grammes per person per day,_Z,Not applicable,1962,,109.1,,A,Normal value,0,Units,,
DATAFLOW,OECD.ELS.HD:DSD_HEALTH_LVNG@DF_HEALTH_LVNG(1.0),Risk factors for health,I,USA,United States,A,Annual,FTS,Fat supply,_T,Total,_T,Total,G_PS_D,Grammes per person per day,_Z,Not applicable,1963,,110.7,,A,Normal value,0,Units,,
DATAFLOW,OECD.ELS.HD:DSD_HEALTH_LVNG@DF_HEALTH_LVNG(1.0),Risk factors for health,I,USA,United States,A,Annual,FTS,Fat supply,_T,Total,_T,Total,G_PS_D,Grammes per person per day,_Z,Not applicable,1964,,114.2,,A,Normal value,0,Units,,
DATAFLOW,OECD.ELS.HD:DSD_HEALTH_LVNG@DF_HEALTH_LVNG(1.0),Risk factors for health,I,USA,United States,A,Annual,FTS,Fat supply,_T,Total,_T,Total,G_PS_D,Grammes per person per day,_Z,Not applicable,1965,,113,,A,Normal value,0,Units,,
DATAFLOW,OECD.ELS.HD:DSD_HEALTH_LVNG@DF_HEALTH_LVNG(1.0),Risk factors for health,I,USA,United States,A,Annual,FTS,Fat supply,_T,Total,_T,Total,G_PS_D,Grammes per person per day,_Z,Not applicable,1966,,114.5,,A,Normal value,0,Units,,
DATAFLOW,OECD.ELS.HD:DSD_HEALTH_LVNG@DF_HEALTH_LVNG(1.0),Risk factors for health,I,USA,United States,A,Annual,FTS,Fat supply,_T,Total,_T,Total,G_PS_D,Grammes per person per day,_Z,Not applicable,1967,,116.1,,A,Normal value,0,Units,,
DATAFLOW,OECD.ELS.HD:DSD_HEALTH_LVNG@DF_HEALTH_LVNG(1.0),Risk factors for health,I,USA,United States,A,Annual,FTS,Fat supply,_T,Total,_T,Total,G_PS_D,Grammes per person per day,_Z,Not applicable,1968,,117.6,,A,Normal value,0,Units,,
DATAFLOW,OECD.ELS.HD:DSD_HEALTH_LVNG@DF_HEALTH_LVNG(1.0),Risk factors for health,I,USA,United States,A,Annual,FTS,Fat supply,_T,Total,_T,Total,G_PS_D,Grammes per person per day,_Z,Not applicable,1969,,118,,A,Normal value,0,Units,,
DATAFLOW,OECD.ELS.HD:DSD_HEALTH_LVNG@DF_HEALTH_LVNG(1.0),Risk factors for health,I,USA,United States,A,Annual,FTS,Fat supply,_T,Total,_T,Total,G_PS_D,Grammes per person per day,_Z,Not applicable,1970,,119.7,,A,Normal value,0,Units,,
DATAFLOW,OECD.ELS.HD:DSD_HEALTH_LVNG@DF_HEALTH_LVNG(1.0),Risk factors for health,I,AUS,Australia,A,Annual,FTS,Fat supply,_T,Total,_T,Total,G_PS_D,Grammes per person per day,_Z,Not applicable,1961,,95.3,,A,Normal value,0,Units,,
DATAFLOW,OECD.ELS.HD:DSD_HEALTH_LVNG@DF_HEALTH_LVNG(1.0),Risk factors for health,I,AUS,Australia,A,Annual,FTS,Fat supply,_T,Total,_T,Total,G_PS_D,Grammes per person per day,_Z,Not applicable,1962,,97.1,,A,Normal value,0,Units,,
DATAFLOW,OECD.ELS.HD:DSD_HEALTH_LVNG@DF_HEALTH_LVNG(1.0),Risk factors for health,I,AUS,Australia,A,Annual,FTS,Fat supply,_T,Total,_T,Total,G_PS_D,Grammes per person per day,_Z,Not applicable,1963,,99.2,,A,Normal value,0,Units,,
DATAFLOW,OECD.ELS.HD:DSD_HEALTH_LVNG@DF_HEALTH_LVNG(1.0),Risk factors for health,I,AUS,Australia,A,Annual,FTS,Fat supply,_T,Total,_T,Total,G_PS_D,Grammes per person per day,_Z,Not applicable,1964,,101.8,,A,Normal value,0,Units,,
DATAFLOW,OECD.ELS.HD:DSD_HEALTH_LVNG@DF_HEALTH_LVNG(1.0),Risk factors for health,I,AUS,Australia,A,Annual,FTS,Fat supply,_T,Total,_T,Total,G_PS_D,Grammes per person per day,_Z,Not applicable,1965,,103.4,,A,Normal value,0,Units,,
DATAFLOW,OECD.ELS.HD:DSD_HEALTH_LVNG@DF_HEALTH_LVNG(1.0),Risk factors for health,I,AUS,Australia,A,Annual,FTS,Fat supply,_T,Total,_T,Total,G_PS_D,Grammes per person per day,_Z,Not applicable,1966,,105.7,,A,Normal value,0,Units,,
DATAFLOW,OECD.ELS.HD:DSD_HEALTH_LVNG@DF_HEALTH_LVNG(1.0),Risk factors for health,I,AUS,Australia,A,Annual,FTS,Fat supply,_T,Total,_T,Total,G_PS_D,Grammes per person per day,_Z,Not applicable,1967,,107.3,,A,Normal value,0,Units,,
DATAFLOW,OECD.ELS.HD:DSD_HEALTH_LVNG@DF_HEALTH_LVNG(1.0),Risk factors for health,I,AUS,Australia,A,Annual,FTS,Fat supply,_T,Total,_T,Total,G_PS_D,Grammes per person per day,_Z,Not applicable,1968,,109.1,,A,Normal value,0,Units,,
DATAFLOW,OECD.ELS.HD:DSD_HEALTH_LVNG@DF_HEALTH_LVNG(1.0),Risk factors for health,I,AUS,Australia,A,Annual,FTS,Fat supply,_T,Total,_T,Total,G_PS_D,Grammes per person per day,_Z,Not applicable,1969,,110.5,,A,Normal value,0,Units,,
DATAFLOW,OECD.ELS.HD:DSD_HEALTH_LVNG@DF_HEALTH_LVNG(1.0),Risk factors for health,I,AUS,Australia,A,Annual,FTS,Fat supply,_T,Total,_T,Total,G_PS_D,Grammes per person per day,_Z,Not applicable,1970,,112.2,,A,Normal value,0,Units,,
DATAFLOW,OECD.ELS.HD:DSD_HEALTH_LVNG@DF_HEALTH_LVNG(1.0),Risk factors for health,I,GBR,United Kingdom,A,Annual,FTS,Fat supply,_T,Total,_T,Total,G_PS_D,Grammes per person per day,_Z,Not applicable,1961,,132.8,,A,Normal value,0,Units,,
DATAFLOW,OECD.ELS.HD:DSD_HEALTH_LVNG@DF_HEALTH_LVNG(1.0),Risk factors for health,I,GBR,United Kingdom,A,Annual,FTS,Fat supply,_T,Total,_T,Total,G_PS_D,Grammes per person per day,_Z,Not applicable,1962,,133.1,,A,Normal value,0,Units,,
DATAFLOW,OECD.ELS.HD:DSD_HEALTH_LVNG@DF_HEALTH_LVNG(1.0),Risk factors for health,I,GBR,United Kingdom,A,Annual,FTS,Fat supply,_T,Total,_T,Total,G_PS_D,Grammes per person per day,_Z,Not applicable,1963,,134.7,,A,Normal value,0,Units,,
DATAFLOW,OECD.ELS.HD:DSD_HEALTH_LVNG@DF_HEALTH_LVNG(1.0),Risk factors for health,I,GBR,United Kingdom,A,Annual,FTS,Fat supply,_T,Total,_T,Total,G_PS_D,Grammes per person per day,_Z,Not applicable,1964,,137.2,,A,Normal value,0,Units,,
DATAFLOW,OECD.ELS.HD:DSD_HEALTH_LVNG@DF_HEALTH_LVNG(1.0),Risk factors for health,I,GBR,United Kingdom,A,Annual,FTS,Fat supply,_T,Total,_T,Total,G_PS_D,Grammes per person per day,_Z,Not applicable,1965,,139.4,,A,Normal value,0,Units,,
DATAFLOW,OECD.ELS.HD:DSD_HEALTH_LVNG@DF_HEALTH_LVNG(1.0),Risk factors for health,I,GBR,United Kingdom,A,Annual,FTS,Fat supply,_T,Total,_T,Total,G_PS_D,Grammes per person per day,_Z,Not applicable,1966,,141.8,,A,Normal value,0,Units,,
DATAFLOW,OECD.ELS.HD:DSD_HEALTH_LVNG@DF_HEALTH_LVNG(1.0),Risk factors for health,I,GBR,United Kingdom,A,Annual,FTS,Fat supply,_T,Total,_T,Total,G_PS_D,Grammes per person per day,_Z,Not applicable,1967,,143.5,,A,Normal value,0,Units,,
DATAFLOW,OECD.ELS.HD:DSD_HEALTH_LVNG@DF_HEALTH_LVNG(1.0),Risk factors for health,I,GBR,United Kingdom,A,Annual,FTS,Fat supply,_T,Total,_T,Total,G_PS_D,Grammes per person per day,_Z,Not applicable,1968,,145.2,,A,Normal value,0,Units,,
DATAFLOW,OECD.ELS.HD:DSD_HEALTH_LVNG@DF_HEALTH_LVNG(1.0),Risk factors for health,I,GBR,United Kingdom,A,Annual,FTS,Fat supply,_T,Total,_T,Total,G_PS_D,Grammes per person per day,_Z,Not applicable,1969,,146.8,,A,Normal value,0,Units,,
DATAFLOW,OECD.ELS.HD:DSD_HEALTH_LVNG@DF_HEALTH_LVNG(1.0),Risk factors for health,I,GBR,United Kingdom,A,Annual,FTS,Fat supply,_T,Total,_T,Total,G_PS_D,Grammes per person per day,_Z,Not applicable,1970,,148.1,,A,Normal value,0,Units,,`;

                const data = d3.csvParse(csvContent);

                data.forEach(d => {
                    d.OBS_VALUE = +d.OBS_VALUE;
                    d.TIME_PERIOD = +d.TIME_PERIOD;
                });

                const validData = data.filter(d => !isNaN(d.OBS_VALUE) && !isNaN(d.TIME_PERIOD));

                const measures = Array.from(new Set(validData.map(d => d.Measure))).sort();
                const select = d3.select("#measure-select");

                select.selectAll("option").remove();
                select.selectAll("option")
                    .data(measures)
                    .enter()
                    .append("option")
                    .attr("value", d => d)
                    .text(d => d);

                d3.select("#chart-container .loading").remove();

                createChart();

                function createChart() {
                    const svg = d3.select("#chart-container")
                        .append("svg")
                        .attr("width", width)
                        .attr("height", height);

                    const chart = svg.append("g")
                        .attr("transform", `translate(${margin.left},${margin.top})`);

                    const tooltip = d3.select("#tooltip");

                    function updateChart(selectedMeasure) {
                        const filtered = validData.filter(d => d.Measure === selectedMeasure);

                        if (filtered.length === 0) {
                            chart.selectAll("*").remove();
                            chart.append("text")
                                .attr("x", chartWidth / 2)
                                .attr("y", chartHeight / 2)
                                .style("text-anchor", "middle")
                                .style("font-size", "1.2rem")
                                .style("fill", "#666")
                                .text("No data available for this measure");
                            return;
                        }

                        const nested = d3.group(filtered, d => d["Reference area"]);
                        const countries = Array.from(nested.keys());

                        const x = d3.scaleLinear()
                            .domain(d3.extent(filtered, d => d.TIME_PERIOD))
                            .range([0, chartWidth]);

                        const y = d3.scaleLinear()
                            .domain(d3.extent(filtered, d => d.OBS_VALUE))
                            .nice()
                            .range([chartHeight, 0]);

                        const colorScale = d3.scaleOrdinal(d3.schemeCategory10);

                        chart.selectAll("*").remove();

                        chart.append("text")
                            .attr("class", "chart-title")
                            .attr("x", chartWidth / 2)
                            .attr("y", -20)
                            .text(selectedMeasure);

                        chart.append("g")
                            .attr("class", "axis")
                            .attr("transform", `translate(0,${chartHeight})`)
                            .call(d3.axisBottom(x).tickFormat(d3.format("d")));

                        chart.append("text")
                            .attr("class", "axis-label")
                            .attr("x", chartWidth / 2)
                            .attr("y", chartHeight + 50)
                            .style("text-anchor", "middle")
                            .text("Year");

                        chart.append("g")
                            .attr("class", "axis")
                            .call(d3.axisLeft(y));

                        const unitMeasure = filtered[0]["Unit of measure"];
                        chart.append("text")
                            .attr("class", "axis-label")
                            .attr("transform", "rotate(-90)")
                            .attr("x", -chartHeight / 2)
                            .attr("y", -50)
                            .style("text-anchor", "middle")
                            .text(unitMeasure);

                        const line = d3.line()
                            .x(d => x(d.TIME_PERIOD))
                            .y(d => y(d.OBS_VALUE))
                            .curve(d3.curveMonotoneX);

                        nested.forEach((values, country) => {
                            const sortedValues = values.sort((a, b) => a.TIME_PERIOD - b.TIME_PERIOD);

                            chart.append("path")
                                .datum(sortedValues)
                                .attr("class", "line")
                                .attr("stroke", colorScale(country))
                                .attr("d", line);

                            chart.selectAll(`.point-${country.replace(/\s+/g, '-')}`)
                                .data(sortedValues)
                                .enter()
                                .append("circle")
                                .attr("class", `point-${country.replace(/\s+/g, '-')}`)
                                .attr("cx", d => x(d.TIME_PERIOD))
                                .attr("cy", d => y(d.OBS_VALUE))
                                .attr("r", 4)
                                .attr("fill", colorScale(country))
                                .on("mouseover", function (event, d) {
                                    tooltip.style("opacity", 1)
                                        .html(`<strong>${country}</strong><br/>Year: ${d.TIME_PERIOD}<br/>Value: ${d.OBS_VALUE.toFixed(1)} ${unitMeasure}`)
                                        .style("left", (event.pageX + 10) + "px")
                                        .style("top", (event.pageY - 10) + "px");
                                })
                                .on("mouseout", function () {
                                    tooltip.style("opacity", 0);
                                });

                            const lastPoint = sortedValues[sortedValues.length - 1];
                            chart.append("text")
                                .attr("class", "country-label")
                                .attr("x", x(lastPoint.TIME_PERIOD) + 8)
                                .attr("y", y(lastPoint.OBS_VALUE) + 4)
                                .text(country)
                                .style("fill", colorScale(country));
                        });
                    }

                    select.on("change", function () {
                        updateChart(this.value);
                    });

                    if (measures.length > 0) {
                        updateChart(measures[0]);
                    }
                }

            } catch (error) {
                console.error("Error loading data:", error);
                d3.select("#chart-container").html('<div class="loading">Error loading data</div>');
            }
        }

        loadData();
    </script>

</body>

</html>